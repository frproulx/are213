
\documentclass[a4paper, 12pt]{article}

\usepackage{graphicx}
\usepackage{longtable}

\begin{document}
\title{ARE213 Problem Set \#1A}
\author{Peter Alstone \& Frank Proulx}
\maketitle

\section{Problem \#1}
\subsection{Part A}

Data records are excluded from the dataset based whether the following variables take the noted values \(as found in the data manual\):

\subsection{Part B}
We dropped all rows where any data were missing in that row.  One way that the data cleaning process could be improved would be to only remove records based on the variables of interest (as are determined in subsequent analysis) since missing values in fields that are not eventually used in the analysis do not pose a problem..  This would result in a more iterative approach, however, and increase workload on the researcher.

We used some exploratory analysis to understand if the records that were dropped due to missing data \textit{somewhere} in the record were representative.  First we compared a few simple summary statistics between the "full record" and "partial record" data on variables of interest for this analysis.  These are summarized in Table \ref{tab:compareMissingData}.  Better APGAR scores and lower incidence of smoking may be correlated with having full datasets, which indicates the people who have missing data may bias the sample.  We also used agnostic linear regression to understand the relationship between the presence of full records and three key variables: one-minute apgar (omaps), five-minute apgar (fmaps), and number of cigarettes smoked each day (cigar).  The results summarized in Table \ref{tab:lmMissingData} indicate there is statistical significance in each of the factors (i.e. all three are useful predictors for whether a person has a full data record) but also that the influence of the factors is small.  Figure \ref{fig:cigarFullData} shows the distribution in the number of cigarettes smoked by those with and without full records.  The distribution of values is basically the same (clusters around multiples of five up to 20, or, a "pack a day") between the two datasets.  

Overall, in spite of the bias from removing heavier smokers with lower apgar scores from the data, the overall number removed is relatively small and the size of the bias (indicated by the coefficients in the linear model) is relatively small.  

% Table created by stargazer v.4.0 by Marek Hlavac, Harvard University. E-mail: hlavac at fas.harvard.edu
% Date and time: Thu, Sep 19, 2013 - 16:27:57
\begin{table}[!htbp] \centering 
  \caption{Comparison of data with full records to those with missing data across key variables} 
  \label{tab:compareMissingData} 
  \footnotesize
\begin{tabular}{@{\extracolsep{5pt}} ccccccc} 
\\[-1.8ex]\hline 
\hline \\[-1.8ex] 
full.record & mean.omaps & sd.omaps & mean.fmaps & sd.fmaps & mean.cigar & sd.cigar \\ 
\hline \\[-1.8ex] 
FALSE & $7.905$ & $1.572$ & $8.880$ & $1.030$ & $3.945$ & $7.422$ \\ 
TRUE & $8.117$ & $1.260$ & $9.009$ & $0.707$ & $1.907$ & $5.297$ \\ 
\hline \\[-1.8ex] 
\end{tabular} 
\end{table} 


% Table created by stargazer v.4.0 by Marek Hlavac, Harvard University. E-mail: hlavac at fas.harvard.edu
% Date and time: Thu, Sep 19, 2013 - 16:32:14
\begin{table}[!htbp] \centering 
  \caption{Linear model results for predicting whether full records are present based on selected variable of interest in the dataset} 
  \label{tab:lmMissingData} 
\begin{tabular}{@{\extracolsep{5pt}}lc} 
\\[-1.8ex]\hline 
\hline \\[-1.8ex] 
 & \multicolumn{1}{c}{\textit{Dependent variable:}} \\ 
\cline{2-2} 
\\[-1.8ex] & full.record \\ 
\hline \\[-1.8ex] 
 omaps & 0.002$^{***}$ \\ 
  & (0.001) \\ 
  & \\ 
 fmaps & 0.007$^{***}$ \\ 
  & (0.001) \\ 
  & \\ 
 cigar & $-$0.003$^{***}$ \\ 
  & (0.0001) \\ 
  & \\ 
 Constant & 0.882$^{***}$ \\ 
  & (0.007) \\ 
  & \\ 
\hline \\[-1.8ex] 
Observations & 119,384 \\ 
R$^{2}$ & 0.007 \\ 
Adjusted R$^{2}$ & 0.007 \\ 
Residual Std. Error & 0.195 \\ 
F Statistic & 276.305 \\ 
\hline 
\hline \\[-1.8ex] 
\textit{Note:}  & \multicolumn{1}{r}{$^{*}$p$<$0.1; $^{**}$p$<$0.05; $^{***}$p$<$0.01} \\ 
\normalsize 
\end{tabular} 
\end{table}


\begin{figure}[!h] %  figure placement: here, top, bottom, or page
   \centering
   \includegraphics[width=4in]{img/cigar-by-record-type.pdf} 
   \caption{Cigarette use rate by presence of full data record.}
   \label{fig:cigarFullData}
\end{figure}

\subsection{Part C}
The summary table for the remaining data after cleaning is below.
% Code for the summary table from file summarytable.tex starts here...
% latex.default(summarytable) 
%

\input{clean-summary.tex} % need to fix this table so it is more visible...currently runs off the page.  

\section{Problem \#2}

\subsection{Part A}

The table below shows the mean differences between smoking and non-smoking mothers for one-minute APGAR scores (ompas), five-minute (fmaps), and birth weight in grams (dbrwt).  Unconditioned on the other variables, there is no statistically significant difference in APGAR score but a significant difference is present in birth weight\footnote{Welch Two Sample t-test, alternative hypothesis: true difference in means is not equal to 0; p-value less than 2.2e-16, 95 percent confidence interval: -249.5463 to -231.4093}.   

% Table created by stargazer v.4.0 by Marek Hlavac, Harvard University. E-mail: hlavac at fas.harvard.edu
% Date and time: Sat, Sep 21, 2013 - 00:11:19
\begin{table}[!htbp] \centering 
  \caption{Comparison of key birthing infant health indicators for different maternal smoking status} 
  \label{} 
\begin{tabular}{@{\extracolsep{5pt}} cccc} 
\\[-1.8ex]\hline 
\hline \\[-1.8ex] 
tobacco & mean.omaps & mean.fmaps & mean.dbrwt \\ 
\hline \\[-1.8ex] 
smoker & 8.10 & 9.01 & 3171 \\ 
nonsmoker & 8.12 & 9.01 & 3412 \\ 
difference & 0.017 & 0.0001 & 240.5 \\ 
\hline \\[-1.8ex] 
\normalsize 
\end{tabular} 
\end{table} 


\subsection{Part B}

The average treatment effect (ATE) of maternal smoking can only be determined by comparing the unadjusted difference in mean birth weight of infants \textbf{if their mothers were randomly assigned into treatment (a smoking habit during pregnancy) or the assignment / selection to treatment is as good as random}.  This is obviously not possible or even palatable for a variety of practical and ethical reasons to verify with RCT so an alternative approach to identifying the ATE that controls for observables is the next-best option.  If we assume that smoking habits are randomly assigned among pregnant mothers, it can be "safe" to use the unadjusted difference in weight as a predictor of ATE without conditioning on observables as long as there are not any significant differences in the smoking and non-smoking groups that also influence birth weight.  In the next set of steps we explore other factors that may influence birth weight and if they are also related to smoking status.  
  

\paragraph{ATE using unadjusted differences:}
If we were to assume that smoking is in fact randomly assigned, the mean difference in birth weight caused by smoking between infants whose mothers smoke and those who do not is 240 grams (with a 95\% confidence interval of 230 - 250 grams). Infants whose mother smoked have about  7\% lower birth weight than those who did not. \newline{}

\paragraph{Identifying potential confounding factors:}
We used deductive logic and graphical exploration to understand factors that may influence birth weight and should be controlled for if the tobacco users / non-users have distributions that are not identical (or very similar) between them.  Several (bot not all) of the factors that we identified as potential candidates are summarized in the Table \ref{tab:xtabsTobacco}.  We omitted many that did not show a relationship between the factor and birth weight for brevity.  The results show that most of the potential factors related to birth weight do not appear likely to be also related to smoking status.  \newline

\input{crosstab-tobacco.tex} %Table with sample cross tabs for smoking status and a variety of factors.

The factors we identify as having an impact on birth weight AND being related to smoking status are:

\begin{itemize}

\item \textbf{Maternal Age} is different between the smoking / non-smoking group and is related to birth weight.  The median pregnant smoker is two years younger than the median non-smoker.  There is also a relationship between age and birth weight (where older mothers up to age 31-32 or so tend to have heavier babies).  The relationship between maternal age and birth weight along with the distributions in age for smokers and non-smokers is shown in Figure \ref{fig:bwAge}

\item \textbf{Marital Status} is quite different between the smoking and non-smoking groups: single mothers are more likely to smoke in pregnancy.  In the whole sample the fraction of women who are married is 75\% but in the "smoker" subsample it is only 52\%.  There is also a relationship between marital status and birth weight whereby married mothers tend to have slightly heavier babies.  These relationships are shown in Figure \ref{fig:bwMar}.

\item \textbf{Maternal weight gain (less certain)} is related to infant weight at birth but as we note is not as certain in terms of being related strongly with smoking status.  The median weight gain is quite similar between the two smoking status groups (29 lbs for smokers vs. 30 lbs for non-smokers) but there is a larger difference in the 25th percentile weight (20 vs. 24 lbs.).  The relationship between maternal weight gain and infant weight gain along with the distribution in maternal gain by smoking status is summarized in Figure \ref{fig:bwGain}

\begin{figure}[htbp]
\begin{center}
\includegraphics{img/bw-age.pdf}
\caption{(Top) The relationship between Maternal Age and Birth Weight with a GAM fit to the data and 95\% confidence interval estimate in grey.  Actual data are omitted to show the average trend more clearly.  (Bottom panels) A comparison in the distribution of Maternal Age for smokers and non-smokers shows how smokers tend to be younger mothers.}
\label{fig:bwAge}
\end{center}
\end{figure}

\begin{figure}[htbp]
\begin{center}
\includegraphics{img/bw-mar.pdf}
\caption{Boxplots for birth weight by marital status of the mother.}
\label{fig:bwMar}
\end{center}
\end{figure}

\begin{figure}[htbp]
\begin{center}
\includegraphics{img/bw-gain.pdf}
\caption{(Top) The relationship between Maternal Weight Gain and Birth Weight with a GAM fit to the data and 95\% confidence interval estimate in grey.  Actual data are omitted to show the average trend more clearly.  (Bottom panels) A comparison in the distribution of Maternal Weight Gain for smokers and non-smokers shows how smokers tend to have (slightly) less weight gain.}
\label{fig:bwGain}
\end{center}
\end{figure}

\end{itemize}
Because of the factors we identified the assumption that smoking is randomly assigned in the pop ulation(and using unadjusted mean differences) is not tenable for obtaining an accurate prediction of ATE. 


\pagebreak
\section{Appendix}
R code for problem \#1: % REPLACE / UPDATE WHEN DONE.....
\begin{verbatim}
### This is Frank Proulx's solution to ARE213 PS1a, problem 1
## Data is in the file "ps1.dta"

library(foreign) #this is to read in Stata data
library(Hmisc)
library(psych)
data <- read.dta("ps1.dta")

print(nrow(data))

## Problem 1a: Fix missing values
## The following are the error codes for each of the 15 variables that need fixing:
# cardiac: 9
# lung: 9
# diabetes: 9
# herpes: 9
# chyper: 9
# phyper: 9
# pre4000: 9
# preterm: 9
# tobacco: 9
# cigar: 99
# cigar6: 6
# alcohol: 9
# drink: 99
# drink5: 5
# wgain: 99

data <- subset (data, (cardiac != 9) & (lung != 9) & (diabetes !=9) & (herpes !=9) & (chyper !=9) & (phyper !=9) & (pre4000 !=9) & (preterm !=9) & (tobacco !=9) & (cigar !=99) & (cigar6 !=6) & (alcohol !=9) & (drink !=99) & (drink5 !=5) & (wgain !=99))

print(nrow(data)) #number of records remaining after cleaning

print(describe(data, skew=FALSE, ranges=FALSE))

write.csv(data, file = "ps1dataclean.csv")

#'omaps' and 'fmaps' are the APGAR scores
#'dbrwt' is the birth weight in grams
# 'tobacco' is smoker status (1=yes, 2=no)

smokers <- subset(data, tobacco==1)
nonsmokers <- subset(data, tobacco==2)

smokerstats <- c(mean(smokers$omaps), mean(smokers$fmaps), mean(smokers$dbrwt))
nonsmokerstats <- c(mean(nonsmokers$omaps), mean(nonsmokers$fmaps), mean(nonsmokers$dbrwt))
meandif <- nonsmokerstats - smokerstats

print(smokerstats)
print(nonsmokerstats)
print(meandif)

print(t.test(data$omaps~data$tobacco))
print(t.test(data$fmaps~data$tobacco))
print(t.test(data$dbrwt~data$tobacco))
\end{verbatim}

\end{document}
