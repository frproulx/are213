print(nrow(ps1.data)) #number of records remaining after cleaning
?subset
attach(ps1.data)
detach(name=ps1.data)
wgain %in% names(ps1.data)
"wgain" %in% names(ps1.data)
?match
match("wgain", names(ps1.data))
match("alcohol", names(ps1.data))
full.record.flag <- which(ps1.data$cardiac != 9 & ps1.data$lung != 9 & ps1.data$diabetes !=9 & ps1.data$herpes != 9 & ps1.data$chyper != 9 & ps1.data$phyper != 9 & ps1.data$pre4000 !=9 & ps1.data$preterm != 9 & ps1.data$tobacco != 9 & ps1.data$cigar != 99 & ps1.data$cigar6 !=6 & ps1.data$alcohol != 9 & ps1.data$drink != 99 & ps1.data$drink5 !=5 & ps1.data$wgain !=99)
head(full.record.flag)
ps1.data$full.record <- FALSE # initialize column as F
ps1.data$full.record[full.record.flag] <- TRUE #reassign level to T for full records
head(ps1.data)
View(ps1.data)
ps1.data.clean <- subset (ps1.data, full.record == TRUE)
ps1.data <- read.dta("ps1.dta") #changed name of object from "data" to avoid ambiguity issues since "data" is often embedded in functions as a general object
print(nrow(ps1.data))
## Problem 1a: Fix missing values
## The following are the error codes for each of the 15 variables that need fixing:
# cardiac: 9
# lung: 9
# diabetes: 9
# herpes: 9
# chyper: 9
# phyper: 9
# pre4000: 9
# preterm: 9
# tobacco: 9
# cigar: 99
# cigar6: 6
# alcohol: 9
# drink: 99
# drink5: 5
# wgain: 99
# Identify which records have full data, then add a column to indicate full records or not.
full.record.flag <- which(ps1.data$cardiac != 9 & ps1.data$lung != 9 & ps1.data$diabetes !=9 & ps1.data$herpes != 9 & ps1.data$chyper != 9 & ps1.data$phyper != 9 & ps1.data$pre4000 !=9 & ps1.data$preterm != 9 & ps1.data$tobacco != 9 & ps1.data$cigar != 99 & ps1.data$cigar6 !=6 & ps1.data$alcohol != 9 & ps1.data$drink != 99 & ps1.data$drink5 !=5 & ps1.data$wgain !=99)
ps1.data$full.record <- FALSE # initialize column as F
ps1.data$full.record[full.record.flag] <- TRUE #reassign level to T for full records
ps1.data.clean <- subset (ps1.data, full.record == TRUE)
summarytable<-print(describe(ps1.data.clean, skew=FALSE, ranges=FALSE))
ps1.data.missingvalues <- subset(ps1.data, full.record == FALSE)
require(gdata)
install.packages(gdata)
install.packages("gdata")
aggregate.table(ps1.data, full.record, FUN="mean")
require(gdata)
aggregate.table(ps1.data, full.record, FUN="mean")
aggregate.table(ps1.data, "full.record", FUN="mean")
aggregate.table(ps1.data, "full.record", FUN="mean")
write.csv(ps1.data.clean, file = "ps1dataclean.csv")
?compare
nalysis...apgar, smoking, etc.
ps1.compare.records <- ddply(ps1.data, .full.record, summarize,
mean.omaps = mean(omaps),
sd.omaps = sd(omaps))
require(ddply)
require(plyr)
nalysis...apgar, smoking, etc.
ps1.compare.records <- ddply(ps1.data, .full.record, summarize,
mean.omaps = mean(omaps),
sd.omaps = sd(omaps))
ps1.compare.records <- ddply(ps1.data, .(full.record), summarize,
mean.omaps = mean(omaps),
sd.omaps = sd(omaps))
View(ps1.compare.records)
# compare records on things that matter for this analysis...apgar, smoking, etc.
ps1.compare.records <- ddply(ps1.data, .(full.record), summarize,
mean.omaps = mean(omaps),
sd.omaps = sd(omaps),
mean.fmaps = mean(fmaps),
sd.fmaps = sd(fmaps),
mean.cigar = mean(cigar),
sd.cigar = sd(cigar))
View(ps1.compare.records)
hist(ps1.data.missingvalues$cigar)
# compare records on things that matter for this analysis...apgar, smoking, etc.
ps1.compare.records <- ddply(ps1.data, .(full.record), summarize,
mean.omaps = mean(omaps),
sd.omaps = sd(omaps),
mean.fmaps = mean(fmaps),
sd.fmaps = sd(fmaps),
median.cigar = median(cigar)
)
View(ps1.compare.records)
?quantile
# compare records on things that matter for this analysis...apgar, smoking, etc.
ps1.compare.records <- ddply(ps1.data, .(full.record), summarize,
mean.omaps = mean(omaps),
sd.omaps = sd(omaps),
mean.fmaps = mean(fmaps),
sd.fmaps = sd(fmaps),
median.cigar = median(cigar),
per25.cigar = quantile(cigar,.25, na.rm = TRUE)
)
View(ps1.compare.records)
# compare records on things that matter for this analysis...apgar, smoking, etc.
ps1.compare.records <- ddply(ps1.data, .(full.record), summarize,
mean.omaps = mean(omaps),
sd.omaps = sd(omaps),
mean.fmaps = mean(fmaps),
sd.fmaps = sd(fmaps),
median.cigar = median(cigar),
per25.cigar = quantile(cigar,.25, na.rm = TRUE),
per75.cigar = quantile(cigar,.75, na.rm = TRUE),
per90.cigar = quantile(cigar,.90, na.rm = TRUE),
)
ps1.compare.records <- ddply(ps1.data, .(full.record), summarize,
mean.omaps = mean(omaps),
sd.omaps = sd(omaps),
mean.fmaps = mean(fmaps),
sd.fmaps = sd(fmaps),
median.cigar = median(cigar),
per25.cigar = quantile(cigar,.25, na.rm = TRUE),
per75.cigar = quantile(cigar,.75, na.rm = TRUE),
per90.cigar = quantile(cigar,.90, na.rm = TRUE)
)
View(ps1.compare.records)
error.cigar <- which(ps1.data$cigar == 99)
ps1.data$cigar[error.cigar] <- NA
ps1.compare.records <- ddply(ps1.data, .(full.record), summarize,
mean.omaps = mean(omaps),
sd.omaps = sd(omaps),
mean.fmaps = mean(fmaps),
sd.fmaps = sd(fmaps),
median.cigar = median(cigar),
per25.cigar = quantile(cigar,.25, na.rm = TRUE),
per75.cigar = quantile(cigar,.75, na.rm = TRUE),
per90.cigar = quantile(cigar,.90, na.rm = TRUE)
)
View(ps1.compare.records)
ps1.compare.records <- ddply(ps1.data, .(full.record), summarize,
mean.omaps = mean(omaps),
sd.omaps = sd(omaps),
mean.fmaps = mean(fmaps),
sd.fmaps = sd(fmaps),
median.cigar = median(cigar, na.rm = TRUE),
per25.cigar = quantile(cigar,.25, na.rm = TRUE),
per75.cigar = quantile(cigar,.75, na.rm = TRUE),
per90.cigar = quantile(cigar,.90, na.rm = TRUE),
mean.cigar = mean(cigar, na.rm = TRUE)
)
View(ps1.compare.records)
ps1.compare.records <- ddply(ps1.data, .(full.record), summarize,
mean.omaps = mean(omaps),
sd.omaps = sd(omaps),
mean.fmaps = mean(fmaps),
sd.fmaps = sd(fmaps),
median.cigar = median(cigar, na.rm = TRUE),
per25.cigar = quantile(cigar,.25, na.rm = TRUE),
per75.cigar = quantile(cigar,.75, na.rm = TRUE),
per90.cigar = quantile(cigar,.90, na.rm = TRUE),
mean.cigar = mean(cigar, na.rm = TRUE),
sd.cigar = sd(cigar, na.rm = TRUE)
)
View(ps1.compare.records)
ggplot(ps1.data, aes(x=cigar)) + geom_histogram() + facet_grid(.~full.record)
require(ggplot2)
ggplot(ps1.data, aes(x=cigar)) + geom_histogram() + facet_grid(.~full.record)
ggplot(ps1.data, aes(x=cigar)) + geom_boxplot() + facet_grid(.~full.record)
ggplot(ps1.data, aes(y=cigar)) + geom_boxplot() + facet_grid(.~full.record)
ggplot(ps1.data, aes(cigar)) + geom_boxplot(aes(factor=full.record))
ggplot(ps1.data, aes(cigar)) + geom_boxplot(aes(factor(full.record))
)
ggplot(ps1.data, aes(factor(full.record),cigar)) + geom_boxplot()
ggplot(ps1.data, aes(factor(full.record),cigar)) + geom_boxplot() + ylim(0,15)
ggplot(ps1.data, aes(cigar)) + geom_density() + facet_grid(full.record~.)
ggplot(ps1.data, aes(cigar)) + geom_density() + facet_grid(full.record~.) + xlab("Number of daily cigarettes") + ylab("Density of responses")
ggplot(ps1.data, aes(cigar)) + geom_density() + facet_grid(full.record~.) + xlab("Number of daily cigarettes") + ylab("Density of responses") + ggtitle("TRUE = Full Records Available, FALSE = Missing Records")
pdf(file="/img/cigar-by-record-type.pdf", width = 7, height = 6)
ggplot(ps1.data, aes(cigar)) + geom_density() + facet_grid(full.record~.) + xlab("Number of daily cigarettes") + ylab("Density of responses") + ggtitle("TRUE = Full Records Available, FALSE = Missing Records")
dev.off()
pdf(file="img/cigar-by-record-type.pdf", width = 7, height = 6)
ggplot(ps1.data, aes(cigar)) + geom_density() + facet_grid(full.record~.) + xlab("Number of daily cigarettes") + ylab("Density of responses") + ggtitle("TRUE = Full Records Available, FALSE = Missing Records")
dev.off()
library(car)
attach(Prestige)
detach(Prestige)
data(Prestige)
str(Prestige)
pres <- Prestige
str(pres)
?geom_density
require(ggplot2)
require(plyr)
?geom_density
?density
plot(density(pres$income))
plot(density(pres$income,bw=100))
plot(density(pres$income,bw=500))
plot(density(pres$income,bw=5000))
plot(density(pres$income,bw=50))
plot(density(pres$income,bw=50))
summary(density(pres$income,bw=50))
summary(density(pres$income))
plot(density(pres$income))
plot(density(pres$income, kernel="epanechnikov"))
plot(density(pres$income, kernel="uniform"))
plot(density(pres$income, kernel="rectangular"))
plot(density(pres$income, kernel="g", bw=200))
plot(loess(pres$income))
plot(loess(income ~ education, pres))
?density
require(ggplot2)
require(plyr)
require(np)
install.packages("np")
require(ggplot2)
require(plyr)
require(np)
?np
help.zelig()
require(Zelig)
help.zelig()
help.zelig("models")
?loess
??kern
?auto.arima
??arima
require(forecast)
?auto.arima
average(5, -20)
mean(5,-20)
mean(c(5,-20))
10^10 / 10^6
10^11 / 10^9
?loess
10^9
10*10^9
(10*10^9) / 50
(10*10^9) / 50
100000000
50*300000
50*300000000
setwd("~/Google Drive/ERG/Classes/ARE213/are213/ps1")
# Packages --------
library(foreign) #this is to read in Stata data
library(Hmisc)
library(psych)
library(stargazer)
library(ggplot2) # for neato plotting tools
library(plyr) # for nice data tools like ddply
library(epicalc) # For likelihood ratio test
library(car) # "companion for applied regression" - recode fxn, etc.
library(gmodels) #for Crosstabs
library(splines) # for series regression
library(np) #nonparametric regression
# Homebrewed functions
source("../util/are213-func.R")
source("../util/watercolor.R") # for watercolor plots
# Data -------
ps1.data <- read.dta(file="ps1.dta")
# Data Cleaning Step
full.record.flag <- which(ps1.data$cardiac != 9 &
ps1.data$cardiac != 8 &
ps1.data$lung != 9 &
ps1.data$lung != 8 &
ps1.data$diabetes !=9 &
ps1.data$diabetes !=8 &
ps1.data$herpes != 9 &
ps1.data$herpes != 8 &
ps1.data$chyper != 9 &
ps1.data$chyper != 8 &
ps1.data$phyper != 9 &
ps1.data$phyper != 8 &
ps1.data$pre4000 !=9 &
ps1.data$pre4000 !=8 &
ps1.data$preterm != 9 &
ps1.data$preterm != 8 &
ps1.data$tobacco != 9 &
ps1.data$cigar != 99 &
ps1.data$cigar6 !=6 &
ps1.data$alcohol != 9 &
ps1.data$drink != 99 &
ps1.data$drink5 !=5 &
ps1.data$wgain !=99
)
ps1.data$full.record <- FALSE # initialize column as F
ps1.data$full.record[full.record.flag] <- TRUE #reassign level to T for full records
ps1.data.clean <- subset (ps1.data, full.record == TRUE)
ps1.data.missingvalues <- subset(ps1.data, full.record == FALSE)
# Problem 1a : Describes PS1a results. -------
# Problem 1b --------------
# This is using a series estimator. I think smooth.spline() is the right function to use, but let me know if you think we should be doing kernel regression instead. I'm also not sure how to go about adding interaction terms.  I think a kernel regression is more appropriate here...mostly because I don't know the spline function and there seems to be a good package ("np") for running kernel regression.
baby.bw <- npregbw( dbrwt ~ factor(tobacco) * dmage * factor(dmar),
data = ps1.data.clean,
bwtype = "fixed"
)
names(ps1.data.clean)
baby.bw <- npregbw( dbrwt ~ factor(tobacco) * dmage * factor(dmar),
data = ps1.data.clean,
bwtype = "fixed"
)
baby.bw <- npregbw( dbrwt ~ factor(tobacco) + dmage + factor(dmar),
data = ps1.data.clean,
bwtype = "fixed"
)
?rcs
?rms
install.packages("rms")
require(rms)
?rcs
wsp <- lm(dbrwt ~ factor(tobacco) * ns(dmage) * factor(dmar), data=ps1.data.clean)
summary(wsp)
attr(terms(wsp), "predvars")
wsp$predvars$knots
wsp$predvars$Boundary.knots
class(wsp$predvars)
wsp <- lm(dbrwt ~ factor(tobacco) * ns(dmage, df=10) * factor(dmar), data=ps1.data.clean)
summary(wsp)
attr(terms(wsp), "predvars")
plot(wsp)
stargazer(wsp, type="text")
?predict
predict(esp, newdata(tobacco = 2))
predict(wsp, newdata(tobacco = 2))
predict(wsp, newdata=(tobacco = 2))
predict(wsp, newdata=(tobacco = 2, dmage = 30, dmar = 1))
predict(wsp, newdata=(data.frame(tobacco = 2, dmage = 30, dmar = 1)))
predict(wsp, newdata=(data.frame(tobacco = 1, dmage = 30, dmar = 1)))
predict(wsp, newdata=(data.frame(tobacco = 1, dmage = seq(30, dmar = 1)))
mean(predict(wsp))
mean(predict(wsp), newdata=(data.frame(tobacco = 2)))
mean(predict(wsp), newdata=(data.frame(tobacco = 1)))
summarywsp
summary(wsp)
wsp <- lm(dbrwt ~ ns(dmage, df=10), data=ps1.data.clean)
str(wsp)
plot(ps1.data.clean$dmage, wsp$fitted.values)
wsp.5 <- lm(dbrwt ~ ns(dmage, df=5), data=ps1.data.clean)
?hold
plot(ps1.data.clean$dmage, cbind(wsp$fitted.values, wsp.5$fitted.values)
)
points(ps1.data.clean$dmage, wsp.5$fitted.values)
points(ps1.data.clean$dmage, wsp.5$fitted.values, color="red")
points(ps1.data.clean$dmage, wsp.5$fitted.values, col="red")
wsp.2 <- lm(dbrwt ~ ns(dmage, df=2), data=ps1.data.clean)
points(ps1.data.clean$dmage, wsp.2$fitted.values, col="green")
wsp.rcs <- lm(dbrwt ~ rcs(dmage), data=ps1.data.clean)
points(ps1.data.clean$dmage, wsp.rcs$fitted.values, col="blue")
wsp.noint <- lm(dbrwt ~ factor(tobacco) + rcs(dmage) + factor(dmar), data=ps1.data.clean)
summary(wsp.noint)
wsp.noint.nospline <- lm(dbrwt ~ factor(tobacco) + dmage + factor(dmar), data=ps1.data.clean)
summary(wsp.noint.nospline)
stargazer(wsp.noint)
stargazer(wsp.noint, type="text")
ddd <- lm(dbrwt ~ dmage, data=ps1.data.clean)
points(ps1.data.clean$dmage, ddd$fitted.values, col="brown")
wsp.inter <- lm(dbrwt ~ factor(tobacco) * dmage * factor(dmar), data=ps1.data.clean)
summary(wsp.inter)
?effct
?effect
require(effects)
install.packages("effects")
require(effects)
effect(tobacco, wsp.inter)
effect(factor(tobacco), wsp.inter)
?effect
allEffects(wsp.inter)
allEffects(wsp)
allEffects(wsp.2)
allEffects(wsp.noint)
allEffects(wsp.rcs)
str(wsp.rcs)
str(wsp.inter)
summary.rms(wsp.rcs)
require(rms)
summary.rms(wsp.rcs)
summary.rms
class(wsp.rcs)
specs.rms(wsp.rcs)
library(rms)
summary.rms
# PROBLEM SET 1B
# ARE 213 Fall 2013
# Frank's Directory
#setwd("/media/frank/Data/documents/school/berkeley/fall13/are213/are213/ps1")
# Peter's Directory
#setwd("~/Google Drive/ERG/Classes/ARE213/are213/ps1")
# Packages --------
library(foreign) #this is to read in Stata data
library(Hmisc)
library(psych)
library(stargazer)
library(ggplot2) # for neato plotting tools
library(plyr) # for nice data tools like ddply
library(epicalc) # For likelihood ratio test
library(car) # "companion for applied regression" - recode fxn, etc.
library(gmodels) #for Crosstabs
library(splines) # for series regression
library(np) #nonparametric regression
library(rms) #regression modeling tools
# Homebrewed functions
source("../util/are213-func.R")
source("../util/watercolor.R") # for watercolor plots
# Data -------
ps1.data <- read.dta(file="ps1.dta")
# Data Cleaning Step
full.record.flag <- which(ps1.data$cardiac != 9 &
ps1.data$cardiac != 8 &
ps1.data$lung != 9 &
ps1.data$lung != 8 &
ps1.data$diabetes !=9 &
ps1.data$diabetes !=8 &
ps1.data$herpes != 9 &
ps1.data$herpes != 8 &
ps1.data$chyper != 9 &
ps1.data$chyper != 8 &
ps1.data$phyper != 9 &
ps1.data$phyper != 8 &
ps1.data$pre4000 !=9 &
ps1.data$pre4000 !=8 &
ps1.data$preterm != 9 &
ps1.data$preterm != 8 &
ps1.data$tobacco != 9 &
ps1.data$cigar != 99 &
ps1.data$cigar6 !=6 &
ps1.data$alcohol != 9 &
ps1.data$drink != 99 &
ps1.data$drink5 !=5 &
ps1.data$wgain !=99
)
ps1.data$full.record <- FALSE # initialize column as F
ps1.data$full.record[full.record.flag] <- TRUE #reassign level to T for full records
ps1.data.clean <- subset (ps1.data, full.record == TRUE)
ps1.data.missingvalues <- subset(ps1.data, full.record == FALSE)
wsp <- lm(dbrwt ~ factor(tobacco) * ns(dmage, df=5) * factor(dmar), data=ps1.data.clean)
summary.rms(object=wsp)
?summary.rms
rms(wsp)
rcs()
specs.rms(fit=wsp)
ls(package:rms)
fix(vwReg)
str(wsp)
effects(object=wsp)
effect(term=factor(tobacco), mod=wsp)
effect(term="factor(tobacco)", mod=wsp)
effect(term="factor(dmar)", mod=wsp)
effect(term="rcs(dmage)", mod=wsp)
str(wsp)
wsp$effects
summary(wsp$effects)
summary(wsp)
wsp <- lm(dbrwt ~ factor(tobacco) * ns(dmage, df=2) * factor(dmar), data=ps1.data.clean)
summary(wsp)
wsp <- lm(dbrwt ~ factor(tobacco) * ns(dmage, df=3) * factor(dmar), data=ps1.data.clean)
summary(wsp)
wsp <- lm(dbrwt ~ factor(tobacco) + ns(dmage, df=3) + factor(dmar), data=ps1.data.clean)
wsp.int <- lm(dbrwt ~ factor(tobacco) * ns(dmage, df=3) * factor(dmar), data=ps1.data.clean)
summary(wsp)
wsp.ps1a <- lm(dbrwt ~ factor(tobacco) + dmage + factor(dmar), data=ps1.data.clean)
summary(wsp.ps1a)
effect("factor(tobacco)", wsp)
str(wsp)
wsp$contrasts
wsp$contrasts$factor(tobacco)
wsp$contrasts[[1]]
wsp$contrasts[[1]][1]
?lm
anova(wsp)
anova(wsp.int)
Effect("factor(tobacco)", wsp)
Effect("factor(tobacco)", wsp.int)
?Effect
ps1.data.clean$tobacco.f <- as.factor(ps1.data.clean(tobacco))
ps1.data.clean$tobacco.f <- as.factor(ps1.data.clean$tobacco)
ps1.data.clean$dmar.f <- as.factor(ps1.data.clean$dmar)
wsp.f <- lm(dbrwt ~ tobacco.f + ns(dmage, df=3) + dmar.f, data=ps1.data.clean)
effect("tobacco.f", wsp.f)
wsp.f.int <- lm(dbrwt ~ tobacco.f * ns(dmage, df=3) * dmar.f, data=ps1.data.clean)
effect("tobacco.f", wsp.f.int)
summary(wsp.f.int)
3400-3181
summary(wsp.f)
attr(ps1.data.clean)
str(ps1.data.clean)
attr(ps1.data)
setwd("~/Google Drive/ERG/Classes/ARE213/are213/ps1")
ls()
var.labels <- attr(ps1.data, "var.labels")
var.labels
var.labels <- attr(ps1.data, "var.labels")
test.in <- read.dta(file="ps1.dta", convert.factors = TRUE)
str(test.in)
str(ps1.data)
effect("tobacco.f", wsp.f.int)
effect("tobacco.f", wsp.f.int)->my.effect
table(my.effect)
str(my.effect)
summary(my.effect)
ps1.data.clean$tobacco <- as.factor(ps1.data.clean$tobacco)
ps1.data.clean$dmar <- as.factor(ps1.data.clean$dmar)
wsp.ps1a <- lm(dbrwt ~ tobacco + dmage + dmar, data=ps1.data.clean)
wsp <- lm(dbrwt ~ tobacco + ns(dmage, df=3) + dmar, data=ps1.data.clean)
wsp.int <- lm(dbrwt ~ tobacco * ns(dmage, df=3) * dmar, data=ps1.data.clean)
stargazer(wsp.ps1a, wsp, wsp.int, type="text")
effect("tobacco", wsp)->te.2
plot.eff(te.2)
plot(te.2)
str(wsp)
quartz()
plot(ps1.data.clean$dmage, ps1.data.clean$dbrwt, size=0.25)
plot(ps1.data.clean$dmage, ps1.data.clean$dbrwt, pch=".")
lines(ps1.data.clean$dmage, wsp$fitted.values)
plot(ps1.data.clean$dmage, ps1.data.clean$dbrwt, pch=".")
points(ps1.data.clean$dmage, wsp$fitted.values)
points(ps1.data.clean$dmage, wsp.int$fitted.values, col="green")
effect("tobacco", wsp.int)
table(summary(effect("tobacco", wsp.int)))
# This is the ATE with a complex, interacting splines regression on AGe
summary(effect("tobacco", wsp.int))
