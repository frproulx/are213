error.cigar <- which(ps1.data$cigar == 99)
ps1.data$cigar[error.cigar] <- NA
ps1.compare.records <- ddply(ps1.data, .(full.record), summarize,
mean.omaps = mean(omaps),
sd.omaps = sd(omaps),
mean.fmaps = mean(fmaps),
sd.fmaps = sd(fmaps),
median.cigar = median(cigar),
per25.cigar = quantile(cigar,.25, na.rm = TRUE),
per75.cigar = quantile(cigar,.75, na.rm = TRUE),
per90.cigar = quantile(cigar,.90, na.rm = TRUE)
)
View(ps1.compare.records)
ps1.compare.records <- ddply(ps1.data, .(full.record), summarize,
mean.omaps = mean(omaps),
sd.omaps = sd(omaps),
mean.fmaps = mean(fmaps),
sd.fmaps = sd(fmaps),
median.cigar = median(cigar, na.rm = TRUE),
per25.cigar = quantile(cigar,.25, na.rm = TRUE),
per75.cigar = quantile(cigar,.75, na.rm = TRUE),
per90.cigar = quantile(cigar,.90, na.rm = TRUE),
mean.cigar = mean(cigar, na.rm = TRUE)
)
View(ps1.compare.records)
ps1.compare.records <- ddply(ps1.data, .(full.record), summarize,
mean.omaps = mean(omaps),
sd.omaps = sd(omaps),
mean.fmaps = mean(fmaps),
sd.fmaps = sd(fmaps),
median.cigar = median(cigar, na.rm = TRUE),
per25.cigar = quantile(cigar,.25, na.rm = TRUE),
per75.cigar = quantile(cigar,.75, na.rm = TRUE),
per90.cigar = quantile(cigar,.90, na.rm = TRUE),
mean.cigar = mean(cigar, na.rm = TRUE),
sd.cigar = sd(cigar, na.rm = TRUE)
)
View(ps1.compare.records)
ggplot(ps1.data, aes(x=cigar)) + geom_histogram() + facet_grid(.~full.record)
require(ggplot2)
ggplot(ps1.data, aes(x=cigar)) + geom_histogram() + facet_grid(.~full.record)
ggplot(ps1.data, aes(x=cigar)) + geom_boxplot() + facet_grid(.~full.record)
ggplot(ps1.data, aes(y=cigar)) + geom_boxplot() + facet_grid(.~full.record)
ggplot(ps1.data, aes(cigar)) + geom_boxplot(aes(factor=full.record))
ggplot(ps1.data, aes(cigar)) + geom_boxplot(aes(factor(full.record))
)
ggplot(ps1.data, aes(factor(full.record),cigar)) + geom_boxplot()
ggplot(ps1.data, aes(factor(full.record),cigar)) + geom_boxplot() + ylim(0,15)
ggplot(ps1.data, aes(cigar)) + geom_density() + facet_grid(full.record~.)
ggplot(ps1.data, aes(cigar)) + geom_density() + facet_grid(full.record~.) + xlab("Number of daily cigarettes") + ylab("Density of responses")
ggplot(ps1.data, aes(cigar)) + geom_density() + facet_grid(full.record~.) + xlab("Number of daily cigarettes") + ylab("Density of responses") + ggtitle("TRUE = Full Records Available, FALSE = Missing Records")
pdf(file="/img/cigar-by-record-type.pdf", width = 7, height = 6)
ggplot(ps1.data, aes(cigar)) + geom_density() + facet_grid(full.record~.) + xlab("Number of daily cigarettes") + ylab("Density of responses") + ggtitle("TRUE = Full Records Available, FALSE = Missing Records")
dev.off()
pdf(file="img/cigar-by-record-type.pdf", width = 7, height = 6)
ggplot(ps1.data, aes(cigar)) + geom_density() + facet_grid(full.record~.) + xlab("Number of daily cigarettes") + ylab("Density of responses") + ggtitle("TRUE = Full Records Available, FALSE = Missing Records")
dev.off()
full.record.flag <- which(ps1.data$cardiac != 9 &
ps1.data$lung != 9 &
ps1.data$diabetes !=9 &
ps1.data$herpes != 9 &
ps1.data$chyper != 9 &
ps1.data$phyper != 9 &
ps1.data$pre4000 !=9 &
ps1.data$preterm != 9 &
ps1.data$tobacco != 9 &
ps1.data$cigar != 99 &
ps1.data$cigar6 !=6 &
ps1.data$alcohol != 9 &
ps1.data$drink != 99 &
ps1.data$drink5 !=5 &
ps1.data$wgain !=99
)
setwd("~/Google Drive/ERG/Classes/ARE213/are213/ps1")
library(foreign) #this is to read in Stata data
library(Hmisc)
library(psych)
library(stargazer)
library(ggplot2) # for neato plotting tools
library(plyr) # for nice data tools
ps1.data <- read.dta(file="ps1.dta")
#changed name of object from "data" to avoid ambiguity issues since "data" is often embedded in functions as a general object
print(nrow(ps1.data))
## Problem 1a: Fix missing values --------
## The following are the error codes for each of the 15 variables that need fixing:
# cardiac: 9
# lung: 9
# diabetes: 9
# herpes: 9
# chyper: 9
# phyper: 9
# pre4000: 9
# preterm: 9
# tobacco: 9
# cigar: 99
# cigar6: 6
# alcohol: 9
# drink: 99
# drink5: 5
# wgain: 99
# Identify which records have full data, then add a column to indicate full records or not.
full.record.flag <- which(ps1.data$cardiac != 9 &
ps1.data$lung != 9 &
ps1.data$diabetes !=9 &
ps1.data$herpes != 9 &
ps1.data$chyper != 9 &
ps1.data$phyper != 9 &
ps1.data$pre4000 !=9 &
ps1.data$preterm != 9 &
ps1.data$tobacco != 9 &
ps1.data$cigar != 99 &
ps1.data$cigar6 !=6 &
ps1.data$alcohol != 9 &
ps1.data$drink != 99 &
ps1.data$drink5 !=5 &
ps1.data$wgain !=99
)
ps1.data$full.record <- FALSE # initialize column as F
ps1.data$full.record[full.record.flag] <- TRUE #reassign level to T for full records
# replace error rows in cigar with NA so they don't interfere with other calcs.
error.cigar <- which(ps1.data$cigar == 99)
ps1.data$cigar[error.cigar] <- NA
# compare records on things that matter for this analysis...apgar, smoking, etc.
ps1.compare.records <- ddply(ps1.data, .(full.record), summarize,
mean.omaps = mean(omaps),
sd.omaps = sd(omaps),
mean.fmaps = mean(fmaps),
sd.fmaps = sd(fmaps),
mean.cigar = mean(cigar, na.rm = TRUE),
sd.cigar = sd(cigar, na.rm = TRUE)
)
# There appears to be a variation in the mean cigarette use between groups, but with large standard deviation.
stargazer(ps1.compare.records, summary=FALSE)
# Plot to explore if missing value people smoke more cigarettes
pdf(file="img/cigar-by-record-type.pdf", width = 7, height = 6)
ggplot(ps1.data, aes(cigar)) + geom_density() + facet_grid(full.record~.) + xlab("Number of daily cigarettes") + ylab("Density of responses") + ggtitle("TRUE = Full Records Available, FALSE = Missing Records")
dev.off()
# Linear model to see if you can predict whether the data have a full record based on cigar, omaps, fmaps
unclean.cig <- lm(full.record ~ cigar, ps1.data)
unclean.cig.om <- lm(full.record ~ omaps + cigar, ps1.data)
unclean.cig.om.fm <- lm(full.record ~ omaps + fmaps + cigar, ps1.data)
# The models seem to indicate you can predict whether there is a full record based on apgar and cigarette use....unfortunate.
stargazer(unclean.cig.om.fm)
ps1.data.clean <- subset (ps1.data, full.record == TRUE)
ps1.data.missingvalues <- subset(ps1.data, full.record == FALSE)
"---" %in% ps1.data.clean
"*" %in% ps1.data.clean
test <- as.factor(8)
test != 9
test != 9 | 8
test != 9 & 8
test != 8
test > 8
test != (8 | 9)
8 | 9
full.record.flag <- which(ps1.data$cardiac != 9 &
ps1.data$cardiac != 8 &
ps1.data$lung != 9 &
ps1.data$lung != 8 &
ps1.data$diabetes !=9 &
ps1.data$diabetes !=8 &
ps1.data$herpes != 9 &
ps1.data$herpes != 8 &
ps1.data$chyper != 9 &
ps1.data$chyper != 8 &
ps1.data$phyper != 9 &
ps1.data$phyper != 8 &
ps1.data$pre4000 !=9 &
ps1.data$pre4000 !=8 &
ps1.data$preterm != 9 &
ps1.data$preterm != 8 &
ps1.data$tobacco != 9 &
ps1.data$cigar != 99 &
ps1.data$cigar6 !=6 &
ps1.data$alcohol != 9 &
ps1.data$drink != 99 &
ps1.data$drink5 !=5 &
ps1.data$wgain !=99
)
ps1.data$full.record <- FALSE # initialize column as F
ps1.data$full.record[full.record.flag] <- TRUE #reassign level to T for full records
# replace error rows in cigar with NA so they don't interfere with other calcs.
error.cigar <- which(ps1.data$cigar == 99)
ps1.data$cigar[error.cigar] <- NA
# compare records on things that matter for this analysis...apgar, smoking, etc.
ps1.compare.records <- ddply(ps1.data, .(full.record), summarize,
mean.omaps = mean(omaps),
sd.omaps = sd(omaps),
mean.fmaps = mean(fmaps),
sd.fmaps = sd(fmaps),
mean.cigar = mean(cigar, na.rm = TRUE),
sd.cigar = sd(cigar, na.rm = TRUE)
)
# There appears to be a variation in the mean cigarette use between groups, but with large standard deviation.
stargazer(ps1.compare.records, summary=FALSE)
# Plot to explore if missing value people smoke more cigarettes
pdf(file="img/cigar-by-record-type.pdf", width = 7, height = 6)
ggplot(ps1.data, aes(cigar)) + geom_density() + facet_grid(full.record~.) + xlab("Number of daily cigarettes") + ylab("Density of responses") + ggtitle("TRUE = Full Records Available, FALSE = Missing Records")
dev.off()
# Linear model to see if you can predict whether the data have a full record based on cigar, omaps, fmaps
unclean.cig <- lm(full.record ~ cigar, ps1.data)
unclean.cig.om <- lm(full.record ~ omaps + cigar, ps1.data)
unclean.cig.om.fm <- lm(full.record ~ omaps + fmaps + cigar, ps1.data)
# The models seem to indicate you can predict whether there is a full record based on apgar and cigarette use....unfortunate.
stargazer(unclean.cig.om.fm)
ps1.data.clean <- subset (ps1.data, full.record == TRUE)
ps1.data.missingvalues <- subset(ps1.data, full.record == FALSE)
print(nrow(ps1.data.clean)) #number of records remaining after cleaning
summarytable<-print(describe(ps1.data.clean, skew=FALSE, ranges=FALSE))
latex(summarytable)
write.csv(ps1.data.clean, file = "ps1dataclean.csv")
stargazer(ps1.data.clean, type="text")
stargazer(ps1.data.clean[[-1,]])
stargazer(ps1.data.clean[[-1]])
stargazer(ps1.data.clean[[1:ncol(ps1.data.clean)-1]])
stargazer(ps1.data.clean[[1:10]])
ps1.data.clean[[1:10]]
ps1.data.clean[[1]]
stargazer(ps1.data.clean)
levels(ps1.data.clean$tobacco)
class(ps1.data.clean$tobacco)
smoke.diff <- ddply(ps1.data.clean, .(tobacco), summarize,
mean.omaps = mean(omaps),
mean.fmaps = mean(fmaps),
mean.dbrwt = mean(dbrwt)
)
View(smoke.diff)
smokers <- subset(ps1.data.clean, tobacco==1)
nonsmokers <- subset(ps1.data.clean, tobacco==2)
smokerstats <- c(mean(smokers$omaps), mean(smokers$fmaps), mean(smokers$dbrwt))
nonsmokerstats <- c(mean(nonsmokers$omaps), mean(nonsmokers$fmaps), mean(nonsmokers$dbrwt))
meandif <- nonsmokerstats - smokerstats
smoketable <- matrix(c(smokerstats, nonsmokerstats, meandif), ncol=3, byrow=FALSE)
colnames(smoketable) <- c("Mean Value (Infants with Smoker Mothers)", "Mean Value (Infants with Non-Smoker Mothers)", "Mean Difference between control and treatment")
rownames(smoketable) <- c("one minute APGAR score", "five munute APGAR score", "birthweight")
smoketable <- as.table(smoketable)
fix(smoketable)
stargazer(smoketable, title = "Mean values of health figures in Infants with Smoker and Non-Smoker Mothers", type="text")
smoketable <- as.data.frame(smoketable)
View(smoketable)
View(smoke.diff)
smoke.impact <- ddply(ps1.data.clean, .(tobacco), summarize,
mean.omaps = mean(omaps),
mean.fmaps = mean(fmaps),
mean.dbrwt = mean(dbrwt)
)
diff(smoke.impact)
?apply
apply(smoke.impact, 1, diff)
apply(smoke.impact, 2, diff)
as.matrix(smoke.impact)
apply(smoke.impact, 2, diff) / as.matrix(smoke.impact)[2,]
?rename
?relevel
?rename
revalue(ps1.data.clean$tobacco, c( 1 = "smoker", 2 = "nonsmoker" ))
revalue(ps1.data.clean$tobacco, c( "1" = "smoker", "2" = "nonsmoker" ))
ps1.data.clean$tobacco <- as.factor(ps1.data.clean$tobacco)
revalue(ps1.data.clean$tobacco, c( "1" = "smoker", "2" = "nonsmoker" ))
ps1.data.clean$tobacco <- as.factor(ps1.data.clean$tobacco)
ps1.data.clean$tobacco <- revalue(ps1.data.clean$tobacco, c( "1" = "smoker", "2" = "nonsmoker" ))
?recode
test.it <- stata.get("ps1.dta")
View(test.it)
install.packages("car")
require(car)
?recode
smoke.impact <- ddply(ps1.data.clean, .(tobacco), summarize,
mean.omaps = mean(omaps),
mean.fmaps = mean(fmaps),
mean.dbrwt = mean(dbrwt)
)
View(smoke.impact)
apply(smoke.impact, 2, diff)
?apply
as.matrix(smoke.impact)
as.matrix(smoke.impact)[1,2]
as.matrix(smoke.impact)[1,]
as.matrix(smoke.impact)[1,2:]
as.matrix(smoke.impact)[1,c(2,3,4)]
as.matrix(smoke.impact)[1,c(2,3,4)] - as.matrix(smoke.impact)[2,c(2,3,4)]
as.matrix(smoke.impact)[2,c(2,3,4)]
as.numeric(smoke.impact)
str(smoke.impact)
colSums(smoke.impact[,2:4])
diff(smoke.impact[,2:4])
apply(smoke.impact[,2:4], 1, diff)
apply(smoke.impact[,2:4], 2, diff)
c("difference", apply(smoke.impact[,2:4], 2, diff))
rbind(smoke.impact, c("difference", apply(smoke.impact[,2:4], 2, diff)))
as.factor(difference)
as.factor("difference")
smoke.impact <- ddply(ps1.data.clean, .(tobacco), summarize,
mean.omaps = mean(omaps),
mean.fmaps = mean(fmaps),
mean.dbrwt = mean(dbrwt)
)
rbind(smoke.impact, c(as.factor("difference"), apply(smoke.impact[,2:4], 2, diff)))
as.character(smoke.impact$tobacco)
# conversion to character class for tobacco
smoke.impact$tobacco <- as.character(smoke.impact$tobacco)
# Add difference row
rbind(smoke.impact, c("difference", apply(smoke.impact[,2:4], 2, diff)))
stargazer(smoke.impact, type="text")
stargazer(smoke.impact, type="text", summary=FALSE)
smoke.impact <- rbind(smoke.impact, c("difference", apply(smoke.impact[,2:4], 2, diff)))
stargazer(smoke.impact, type="text", summary=FALSE)
stargazer(smoke.impact, type="text", summary=FALSE, digits = 2)
View(smoketable)
stargazer(smoketable, title = "Mean values of health figures in Infants with Smoker and Non-Smoker Mothers", type="latex")
stargazer(smoke.impact, summary=FALSE, digits = 2)
smoke.impact <- ddply(ps1.data.clean, .(tobacco), diff)
smoke.impact <- ddply(ps1.data.clean, .(tobacco), colSum)
smoke.impact <- ddply(ps1.data.clean, .(tobacco), subset, diff = max(omaps)- min(omaps))
smoke.impact <- ddply(ps1.data.clean, .(tobacco), summarize, diff = max(omaps)- min(omaps))
View(smoke.impact)
smoke.impact <- ddply(ps1.data.clean, .(tobacco), summarize,
mean.omaps = mean(omaps),
mean.fmaps = mean(fmaps),
mean.dbrwt = mean(dbrwt)
)
print(t.test(ps1.data.clean$omaps~ps1.data$tobacco))
print(t.test(ps1.data.clean$omaps~ps1.data.clean$tobacco))
print( t.test( ps1.data.clean$omaps ~ ps1.data.clean$tobacco))
print( t.test( ps1.data.clean$fmaps ~ ps1.data.clean$tobacco))
print( t.test( ps1.data.clean$dbrwt ~ ps1.data.clean$tobacco))
summary( t.test( ps1.data.clean$omaps ~ ps1.data.clean$tobacco))
print( t.test( omaps ~ tobacco, data=ps1.data.clean))
print( t.test( dbrwt ~ tobacco, data = ps1.data.clean))
240/3411
ggplot(ps1.data.clean, aes(x=cigar, y=dbrwt))+geom_point()
ggplot(ps1.data.clean, aes(x=cigar, y=dbrwt))+geom_jitter()
ggplot(ps1.data.clean, aes(x=cigar, y=dbrwt))+geom_jitter() + stat_smooth(method="lm")
ggplot(ps1.data.clean, aes(x=cigar, y=dbrwt))+geom_density() + stat_smooth(method="lm")
?use
?load
setwd("~/Google Drive/ERG/Classes/ARE213/are213/util")
setwd("~/Google Drive/ERG/Classes/ARE213/are213/ps1")
source(../util/are213-func.R)
source("../util/are213-func.R")
source("../util/are213-func.R")
source("../util/watercolor.R") # for watercolor plots
?vwreg
vwreg
vwReg
?vwReg
vwReg(dbrwt ~ tobacco, ps1.data, B=500)
vwReg(dbrwt ~ tobacco, ps1.data, B=5)
vwReg(dbrwt ~ tobacco, ps1.data.clean, B=5)
vwReg(dbrwt ~ cigar, ps1.data.clean, B=5)
vwReg(dbrwt ~ cigar, ps1.data.clean, B=5, method="lm")
vwReg(dbrwt ~ cigar, ps1.data.clean, B=5, method=lm)
?table
table(ps1.data.clean$tobacco, ps1.data.clean$rectype)
xtabs(tobacco~rectype, ps1.data.clean)
xtabs(table(ps1.data.clean$tobacco, ps1.data.clean$rectype))
as.data.frame(table(ps1.data.clean$tobacco, ps1.data.clean$rectype))
xtab(Var1 ~ Var2, as.data.frame(table(ps1.data.clean$tobacco, ps1.data.clean$rectype)))
xtabs(Var1 ~ Var2, as.data.frame(table(ps1.data.clean$tobacco, ps1.data.clean$rectype)))
install.packages(gmodels)
install.packages("gmodels")
require(gmodels)
CrossTable(ps1.data.clean$tobacco, ps1.data.clean$rectype)
xtabs(~tobacco+rectype, data=ps1.data.clean)
?describe
describe(ps1.data.clean)
?summary
require(Hmisc)
summarize(.data=ps1.data.clean, by=llist(tobacco, rectype))
summarize(.data=ps1.data.clean, by=llist(tobacco, rectype), mean)
summarize(ps1.data.clean, by=llist(tobacco, rectype), mean)
xtabs(~tobacco+rectype, data=ps1.data.clean)
?xtabs
CrossTable(ps1.data.clean$tobacco, ps1.data.clean$rectype)
tabular( (Smoke = tobacco) ~ (rectype = rectype) * Percent("col") + 1, data=ps1.data.clean)
library(tables)
install.packages(tables)
install.packages("tables")
tabular( (Smoke = tobacco) ~ (rectype = rectype) * Percent("col") + 1, data=ps1.data.clean)
require(tables)
tabular( (Smoke = tobacco) ~ (rectype = rectype) * Percent("col") + 1, data=ps1.data.clean)
ps1.data.clean$rectype <- as.factor(ps1.data.clean$rectype)
tabular( (Smoke = tobacco) ~ (rectype = rectype) * Percent("col") + 1, data=ps1.data.clean)
latex(tabular( (Smoke = tobacco) ~ (rectype = rectype) * Percent("col") + 1, data=ps1.data.clean))
latex(tabular( (Smoking \n Status = tobacco) ~ (Record Type = rectype) * Percent("col") + 1, data=ps1.data.clean))
latex(tabular( (Smoking Status = tobacco) ~ (Record Type = rectype) * Percent("col") + 1, data=ps1.data.clean))
latex(tabular( (Smoking.Status = tobacco) ~ (Record.Type = rectype) * Percent("col") + 1, data=ps1.data.clean))
latex(tabular( (Smoking Status = tobacco) ~ (Record Type = rectype) * Percent("col"), data=ps1.data.clean))
latex(tabular( (Smoking.Status = tobacco) ~ (Record.Type = rectype) * Percent("col") + 1, data=ps1.data.clean))
latex(tabular( (Smoking.Status = tobacco) ~ (Record.Type = rectype) * mean("col") + 1, data=ps1.data.clean))
tabular( (Smoking.Status = tobacco) ~ (Record.Type = rectype) * mean("col") + 1, data=ps1.data.clean)
tabular( (Smoking.Status = tobacco) ~ (Record.Type = rectype) * Percent("col") + 1, data=ps1.data.clean)
as.data.frame(tabular( (Smoking.Status = tobacco) ~ (Record.Type = rectype) * Percent("col") + 1, data=ps1.data.clean))
as.matrix(tabular( (Smoking.Status = tobacco) ~ (Record.Type = rectype) * Percent("col") + 1, data=ps1.data.clean))
tabular( (Smoking.Status = tobacco) ~ (Record.Type = rectype) * Percent("col") + 1, data=ps1.data.clean)->l
l
cbind(l,l)
tabular( tobacco) ~ rectype) * Percent, data=ps1.data.clean)->l
tabular( tobacco ~ rectype) * Percent, data=ps1.data.clean)->l
tabular( tobacco ~ rectype * Percent, data=ps1.data.clean)->l
tabular( tobacco ~ rectype * Percent("col"), data=ps1.data.clean)->l
l
tabular( tobacco ~ rectype * Percent("col") ~ mean(rectype), data=ps1.data.clean)->l
tabular( tobacco ~ rectype ~ mean(rectype), data=ps1.data.clean)->l
tabular( tobacco ~ rectype * Percent("col") * mean(rectype), data=ps1.data.clean)->l
tabular( tobacco ~ rectype * Percent("col") * mean("row"), data=ps1.data.clean)->l
tabular( tobacco ~ rectype * mean("row"), data=ps1.data.clean)->l
tabular( tobacco ~ rectype * Percent("row"), data=ps1.data.clean)->l
l
tabular( tobacco ~ rectype * Percent("col"), data=ps1.data.clean)->l
CrossTable(ps1.data.clean$tobacco, ps1.data.clean$rectype)
?CrossTable
is.numeric
?is.numeric
class(ps1.data.clean$dbrwt)
str.ps1.data.clean
str(ps1.data.clean)
class(ps1.data.clean$dmage)=="int"
class(ps1.data.clean$dmage)==int
x.tobacco.rectype <- CrossTable(ps1.data.clean$tobacco, ps1.data.clean$)
x.tobacco.rectype <- CrossTable(ps1.data.clean$tobacco, ps1.data.clean$)
x.tobacco.rectype <- CrossTable(ps1.data.clean$tobacco, ps1.data.clean$mrace1)
x.tobacco.rectype <- CrossTable(ps1.data.clean$tobacco, ps1.data.clean$mrace3)
recode
recode(ps1.data.clean$mrace3, recodes=c("1" = "White", "2" = "Other", "3" = "Black"))
?recode
recode(ps1.data.clean$mrace3, ""1" = "White"; "2" = "Other"; "3" = "Black""))
ps1.data.clean$mrace3 <- as.factor(ps1.data.clean$tobacco)
ps1.data.clean$mrace3 <- revalue(ps1.data.clean$tobacco, c( "1" = "White", "2" = "Other", "3" = "Black" ))
ps1.data <- read.dta(file="ps1.dta")
#changed name of object from "data" to avoid ambiguity issues since "data" is often embedded in functions as a general object
print(nrow(ps1.data))
## Problem 1a: Fix missing values --------
## The following are the error codes for each of the 15 variables that need fixing:
# For cardiac - alcohol: "8" means missing record
# cardiac: 9
# lung: 9
# diabetes: 9
# herpes: 9
# chyper: 9
# phyper: 9
# pre4000: 9
# preterm: 9
# tobacco: 9
# cigar: 99
# cigar6: 6
# alcohol: 9
# drink: 99
# drink5: 5
# wgain: 99
# Identify which records have full data, then add a column to indicate full records or not
full.record.flag <- which(ps1.data$cardiac != 9 &
ps1.data$cardiac != 8 &
ps1.data$lung != 9 &
ps1.data$lung != 8 &
ps1.data$diabetes !=9 &
ps1.data$diabetes !=8 &
ps1.data$herpes != 9 &
ps1.data$herpes != 8 &
ps1.data$chyper != 9 &
ps1.data$chyper != 8 &
ps1.data$phyper != 9 &
ps1.data$phyper != 8 &
ps1.data$pre4000 !=9 &
ps1.data$pre4000 !=8 &
ps1.data$preterm != 9 &
ps1.data$preterm != 8 &
ps1.data$tobacco != 9 &
ps1.data$cigar != 99 &
ps1.data$cigar6 !=6 &
ps1.data$alcohol != 9 &
ps1.data$drink != 99 &
ps1.data$drink5 !=5 &
ps1.data$wgain !=99
)
# Column with flags for full records
ps1.data$full.record <- FALSE # initialize column as F
ps1.data$full.record[full.record.flag] <- TRUE #reassign level to T for full records
# Problem 1b: Describe dropped levels --------
# replace error rows in cigar with NA so they don't interfere with other calcs on influence of dropped values.
error.cigar <- which(ps1.data$cigar == 99)
ps1.data$cigar[error.cigar] <- NA
# compare records on things that (might) matter for this analysis...apgar, smoking, etc.
ps1.compare.records <- ddply(ps1.data, .(full.record), summarize,
mean.omaps = mean(omaps),
sd.omaps = sd(omaps),
mean.fmaps = mean(fmaps),
sd.fmaps = sd(fmaps),
mean.cigar = mean(cigar, na.rm = TRUE),
sd.cigar = sd(cigar, na.rm = TRUE)
)
#--> RESULT: There appears to be a variation in the mean cigarette use between groups, but with large standard deviation.
# Print result table for comparison
stargazer(ps1.compare.records, summary=FALSE)
# Plot to explore if missing value people smoke more cigarettes
pdf(file="img/cigar-by-record-type.pdf", width = 7, height = 6)
ggplot(ps1.data, aes(cigar)) + geom_density() + facet_grid(full.record~.) + xlab("Number of daily cigarettes") + ylab("Density of responses") + ggtitle("TRUE = Full Records Available, FALSE = Missing Records")
dev.off()
# Linear model to see if you can predict whether the data have a full record based on cigar, omaps, fmaps
unclean.cig <- lm(full.record ~ cigar, ps1.data)
unclean.cig.om <- lm(full.record ~ omaps + cigar, ps1.data)
unclean.cig.om.fm <- lm(full.record ~ omaps + fmaps + cigar, ps1.data)
# The models seem to indicate you can predict whether there is a full record based on apgar and cigarette use....unfortunate.
stargazer(unclean.cig.om.fm)
ps1.data.clean <- subset (ps1.data, full.record == TRUE)
ps1.data.clean$mrace3 <- as.factor(ps1.data.clean$mrace3)
ps1.data.clean$mrace3 <- revalue(ps1.data.clean$mrace3, c( "1" = "White", "2" = "Other", "3" = "Black" ))
x.tobacco.rectype <- CrossTable(ps1.data.clean$tobacco, ps1.data.clean$mrace3)
#change tobacco to factor and label values
ps1.data.clean$tobacco <- as.factor(ps1.data.clean$tobacco)
ps1.data.clean$tobacco <- revalue(ps1.data.clean$tobacco, c( "1" = "smoker", "2" = "nonsmoker" ))
x.tobacco.rectype <- CrossTable(ps1.data.clean$tobacco, ps1.data.clean$mrace3)
