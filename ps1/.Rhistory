ggplot(ps1.data, aes(x=cigar)) + geom_histogram() + facet_grid(.~full.record)
require(ggplot2)
ggplot(ps1.data, aes(x=cigar)) + geom_histogram() + facet_grid(.~full.record)
ggplot(ps1.data, aes(x=cigar)) + geom_boxplot() + facet_grid(.~full.record)
ggplot(ps1.data, aes(y=cigar)) + geom_boxplot() + facet_grid(.~full.record)
ggplot(ps1.data, aes(cigar)) + geom_boxplot(aes(factor=full.record))
ggplot(ps1.data, aes(cigar)) + geom_boxplot(aes(factor(full.record))
)
ggplot(ps1.data, aes(factor(full.record),cigar)) + geom_boxplot()
ggplot(ps1.data, aes(factor(full.record),cigar)) + geom_boxplot() + ylim(0,15)
ggplot(ps1.data, aes(cigar)) + geom_density() + facet_grid(full.record~.)
ggplot(ps1.data, aes(cigar)) + geom_density() + facet_grid(full.record~.) + xlab("Number of daily cigarettes") + ylab("Density of responses")
ggplot(ps1.data, aes(cigar)) + geom_density() + facet_grid(full.record~.) + xlab("Number of daily cigarettes") + ylab("Density of responses") + ggtitle("TRUE = Full Records Available, FALSE = Missing Records")
pdf(file="/img/cigar-by-record-type.pdf", width = 7, height = 6)
ggplot(ps1.data, aes(cigar)) + geom_density() + facet_grid(full.record~.) + xlab("Number of daily cigarettes") + ylab("Density of responses") + ggtitle("TRUE = Full Records Available, FALSE = Missing Records")
dev.off()
pdf(file="img/cigar-by-record-type.pdf", width = 7, height = 6)
ggplot(ps1.data, aes(cigar)) + geom_density() + facet_grid(full.record~.) + xlab("Number of daily cigarettes") + ylab("Density of responses") + ggtitle("TRUE = Full Records Available, FALSE = Missing Records")
dev.off()
setwd("~/Google Drive/ERG/Classes/ARE213/are213/ps1")
## PACKAGES -------------
library(foreign) #this is to read in Stata data
library(Hmisc)
library(psych)
library(stargazer)
library(ggplot2) # for neato plotting tools
library(plyr) # for nice data tools like ddply
library(car) # "companion for applied regression" - recode fxn, etc.
library(gmodels) #for Crosstabs
# custom functions
source("../util/are213-func.R")
source("../util/watercolor.R") # for watercolor plots
## DATA -------------
ps1.data <- read.dta(file="ps1.dta")
#changed name of object from "data" to avoid ambiguity issues since "data" is often embedded in functions as a general object
print(nrow(ps1.data))
## Problem 1a: Fix missing values --------
## The following are the error codes for each of the 15 variables that need fixing:
# For cardiac - alcohol: "8" means missing record
# cardiac: 9
# lung: 9
# diabetes: 9
# herpes: 9
# chyper: 9
# phyper: 9
# pre4000: 9
# preterm: 9
# tobacco: 9
# cigar: 99
# cigar6: 6
# alcohol: 9
# drink: 99
# drink5: 5
# wgain: 99
# Identify which records have full data, then add a column to indicate full records or not
full.record.flag <- which(ps1.data$cardiac != 9 &
ps1.data$cardiac != 8 &
ps1.data$lung != 9 &
ps1.data$lung != 8 &
ps1.data$diabetes !=9 &
ps1.data$diabetes !=8 &
ps1.data$herpes != 9 &
ps1.data$herpes != 8 &
ps1.data$chyper != 9 &
ps1.data$chyper != 8 &
ps1.data$phyper != 9 &
ps1.data$phyper != 8 &
ps1.data$pre4000 !=9 &
ps1.data$pre4000 !=8 &
ps1.data$preterm != 9 &
ps1.data$preterm != 8 &
ps1.data$tobacco != 9 &
ps1.data$cigar != 99 &
ps1.data$cigar6 !=6 &
ps1.data$alcohol != 9 &
ps1.data$drink != 99 &
ps1.data$drink5 !=5 &
ps1.data$wgain !=99
)
# Column with flags for full records
ps1.data$full.record <- FALSE # initialize column as F
ps1.data$full.record[full.record.flag] <- TRUE #reassign level to T for full records
# Problem 1b: Describe dropped levels --------
# replace error rows in cigar with NA so they don't interfere with other calcs on influence of dropped values.
error.cigar <- which(ps1.data$cigar == 99)
ps1.data$cigar[error.cigar] <- NA
# compare records on things that (might) matter for this analysis...apgar, smoking, etc.
ps1.compare.records <- ddply(ps1.data, .(full.record), summarize,
mean.omaps = mean(omaps),
sd.omaps = sd(omaps),
mean.fmaps = mean(fmaps),
sd.fmaps = sd(fmaps),
mean.cigar = mean(cigar, na.rm = TRUE),
sd.cigar = sd(cigar, na.rm = TRUE)
)
#--> RESULT: There appears to be a variation in the mean cigarette use between groups, but with large standard deviation.
# Print result table for comparison
stargazer(ps1.compare.records, summary=FALSE)
# Plot to explore if missing value people smoke more cigarettes
pdf(file="img/cigar-by-record-type.pdf", width = 7, height = 6)
ggplot(ps1.data, aes(cigar)) + geom_density() + facet_grid(full.record~.) + xlab("Number of daily cigarettes") + ylab("Density of responses") + ggtitle("TRUE = Full Records Available, FALSE = Missing Records")
dev.off()
# Linear model to see if you can predict whether the data have a full record based on cigar, omaps, fmaps
unclean.cig <- lm(full.record ~ cigar, ps1.data)
unclean.cig.om <- lm(full.record ~ omaps + cigar, ps1.data)
unclean.cig.om.fm <- lm(full.record ~ omaps + fmaps + cigar, ps1.data)
# The models seem to indicate you can predict whether there is a full record based on apgar and cigarette use....unfortunate.
stargazer(unclean.cig.om.fm)
ps1.data.clean <- subset (ps1.data, full.record == TRUE)
ps1.data.missingvalues <- subset(ps1.data, full.record == FALSE)
print(nrow(ps1.data.clean)) #number of records remaining after cleaning
# Problem 1c: Summary table of clean data, write a new csv-------
var.labels <- attr(ps1.data, "var.labels")
var.labels[length(var.labels)+1] <- "full record present"
ps1.names <- data.frame("labels" = as.data.frame(var.labels))
colnames(ps1.names)[1] <- "labels"
summarytable<-print(describe(ps1.data.clean, skew=FALSE, ranges=FALSE))
latex(cbind(var.labels,summarytable),longtable=TRUE)
latex(title="clean-summary" , cbind(var.labels,summarytable) , longtable=TRUE)
latex(title="variable" , cbind(var.labels,summarytable))
latex(title="variable", file="clean-summary.tex" , cbind(var.labels,summarytable), caption="Summary of clean Data", vbar=TRUE, size="small")
latex(title="variable", file="clean-summary.tex" , cbind(var.labels,summarytable), caption="Summary of clean Data", vbar=TRUE, size="footnotesize")
View(ps1.data.missingvalues)
cov(ps1.data.clean)
#Problem 2a Simple difference in APGAR and birth weight -------
#'omaps' and 'fmaps' are the APGAR scores
#'dbrwt' is the birth weight in grams
# 'tobacco' is smoker status (1=yes, 2=no)
#change tobacco to factor and label values
ps1.data.clean$tobacco <- as.factor(ps1.data.clean$tobacco)
ps1.data.clean$tobacco <- revalue(ps1.data.clean$tobacco, c( "1" = "smoker", "2" = "nonsmoker" ))
smoke.impact <- ddply(ps1.data.clean, .(tobacco), summarize,
mean.omaps = mean(omaps),
mean.fmaps = mean(fmaps),
mean.dbrwt = mean(dbrwt)
)
# conversion to character class for tobacco
smoke.impact$tobacco <- as.character(smoke.impact$tobacco)
# Add difference row
smoke.impact <- rbind(smoke.impact, c("difference", apply(smoke.impact[,2:4], 2, diff)))
stargazer(smoke.impact, summary=FALSE, digits = 2)
# Problem 2b -------
print( t.test( omaps ~ tobacco, data = ps1.data.clean))
print( t.test( fmaps ~ tobacco, data = ps1.data.clean))
print( t.test( dbrwt ~ tobacco, data = ps1.data.clean))
#visual representation of relationship:
# Relationships between variables
#recode variables
ps1.data.clean$mrace3 <- as.factor(ps1.data.clean$mrace3)
ps1.data.clean$mrace3 <- revalue(ps1.data.clean$mrace3, c( "1" = "White", "2" = "Other", "3" = "Black" ))
ps1.data.clean$csex <- as.factor(ps1.data.clean$csex)
ps1.data.clean$csex <- revalue(ps1.data.clean$csex, c( "1" = "Male", "2" = "Female"))
ps1.data.clean$dplural <- as.factor(ps1.data.clean$dplural)
ps1.data.clean$dplural <- revalue(ps1.data.clean$dplural, c("1" = "Singleton", "2" = "Twin", "3"= "Triplet", "4" = "Quadruplet", "5" = "Quintuplet+"))
ps1.data.clean$alcohol <- as.factor(ps1.data.clean$alcohol)
ps1.data.clean$alcohol <- revalue(ps1.data.clean$alcohol, c("1" = "Drinker", "2" = "Nondrinker", "9" = "Unk."))
latex(summary( tobacco  ~
mrace3 +
csex +
dplural +
alcohol +
phyper +
chyper +
cardiac +
diabetes +
pre4000 +
dmage +
clingest,
data=ps1.xtab.data,
method="reverse",
overall=TRUE, long=TRUE
),
title = "crosstab-tobacco",
label = "tab:xtabTobacco",
caption = "Contingency table for a range of factors by tobacco use status",
exclude1=F
)
## CrossTabs
ps1.xtab.data <- ps1.data.clean
# Add labels from ps1.data
for(i in 1:length(names(ps1.data))){
label(ps1.xtab.data[[i]]) <- attr(ps1.data, "var.labels")[i]
}
latex(summary( tobacco  ~
mrace3 +
csex +
dplural +
alcohol +
phyper +
chyper +
cardiac +
diabetes +
pre4000 +
dmage +
clingest,
data=ps1.xtab.data,
method="reverse",
overall=TRUE, long=TRUE
),
title = "crosstab-tobacco",
label = "tab:xtabTobacco",
caption = "Contingency table for a range of factors by tobacco use status",
exclude1=F
)
bw.age <- ggplot(ps1.data.clean, aes(dmage, dbrwt))
bw.age + stat_smooth() + geom_points(size=0.2)
bw.age <- ggplot(ps1.data.clean, aes(dmage, dbrwt))
bw.age + stat_smooth() + geom_point(size=0.2)
bw.age <- ggplot(ps1.data.clean, aes(dmage, dbrwt))
bw.age + stat_smooth() + geom_jitter(size=0.2)
bw.age + stat_smooth(size=5) + geom_point(size=0.2)
bw.age <- ggplot(ps1.data.clean, aes(dmage, dbrwt))
bw.age + stat_smooth(size=2) + geom_point(size=0.2)
bw.age + stat_smooth(size=1) +
geom_point(size=0.2) +
theme_bw()
bw.age + stat_smooth(size=1) +
geom_point(size=0.2) +
theme_bw() +
xlab("Maternal Age (years)") +
ylab("Birth Weight (grams)")
pdf(file="img/bw-age.pdf", width=4, height=4)
bw.age <- ggplot(ps1.data.clean, aes(dmage, dbrwt))
bw.age + stat_smooth(size=1) +
geom_point(size=0.2) +
theme_bw() +
xlab("Maternal Age (years)") +
ylab("Birth Weight (grams)")
dev.off()
pdf(file="img/bw-age.pdf", width=4, height=4)
bw.age <- ggplot(ps1.data.clean, aes(dmage, dbrwt))
bw.age + stat_smooth() +
geom_jitter(size=0.1) +
theme_bw() +
xlab("Maternal Age (years)") +
ylab("Birth Weight (grams)")
dev.off()
"dmage" %in% names(ps1.data.clean)
which(names(ps1.data.clean) == "dmage")
ps1.names$labels[which(names(ps1.data.clean) == "dmage")]
split.age <- ggplot(ps1.data.clean, aes(x=dmage))
split.age <- split.age +
geom_density() +
theme_bw() +
facet_grid(.~tobacco)
split.age
split.age <- ggplot(ps1.data.clean, aes(x=dmage))
split.age <- split.age +
geom_density() +
theme_bw() +
facet_grid(tobacco~.)
split.age
# custom functions
source("../util/are213-func.R")
source("../util/watercolor.R") # for watercolor plo
arrange_ggplot2(bw.age, split.age, ncol=1)
arrange_ggplot2(bw.age, split.age, nrow=2)
bw.age
bw.age <- ggplot(ps1.data.clean, aes(dmage, dbrwt))
bw.age <- bw.age +
stat_smooth() +
geom_jitter(size=0.1) +
theme_bw() +
xlab("Maternal Age (years)") +
ylab("Birth Weight (grams)")
bw.age
arrange_ggplot2(bw.age, split.age, ncol=1)
bw.age <- ggplot(ps1.data.clean, aes(dmage, dbrwt))
bw.age <- bw.age +
stat_smooth() +
theme_bw() +
xlab("Maternal Age (years)") +
ylab("Birth Weight (grams)") +
facet_grid(.~full.record)
split.age <- ggplot(ps1.data.clean, aes(x=dmage))
split.age <- split.age +
geom_density() +
theme_bw() +
facet_grid(tobacco~.)
arrange_ggplot2(bw.age, split.age, ncol=1)
bw.age <- bw.age +
stat_smooth() +
theme_bw() +
xlab("Maternal Age (years)") +
ylab("Birth Weight (grams)") +
facet_grid(full.record~.)
arrange_ggplot2(bw.age, split.age, ncol=1)
# birth weight - age
pdf(file="img/bw-age.pdf", width=4, height=8)
bw.age <- ggplot(ps1.data.clean, aes(dmage, dbrwt))
bw.age <- bw.age +
stat_smooth() +
theme_bw() +
xlab("Maternal Age (years)") +
ylab("Birth Weight (grams)") +
facet_grid(full.record~.)
split.age <- ggplot(ps1.data.clean, aes(x=dmage))
split.age <- split.age +
geom_density() +
theme_bw() +
facet_grid(tobacco~.)
arrange_ggplot2(bw.age, split.age, ncol=1)
dev.off()
pdf(file="img/bw-age.pdf", width=4, height=8)
bw.age <- ggplot(ps1.data.clean, aes(dmage, dbrwt))
bw.age <- bw.age +
stat_smooth() +
theme_bw() +
xlab("Maternal Age (years)") +
ylab("Birth Weight (grams)") +
facet_grid(full.record~.)
split.age <- ggplot(ps1.data.clean, aes(x=dmage))
split.age <- split.age +
geom_density() +
theme_bw() +
xlab("Maternal Age (years)") +
ylab("Density in Sub-sample")
facet_grid(tobacco~.)
arrange_ggplot2(bw.age, split.age, ncol=1)
dev.off()
pdf(file="img/bw-age.pdf", width=4, height=8)
bw.age <- ggplot(ps1.data.clean, aes(dmage, dbrwt))
bw.age <- bw.age +
stat_smooth() +
theme_bw() +
xlab("Maternal Age (years)") +
ylab("Birth Weight (grams)") +
facet_grid(full.record~.)
split.age <- ggplot(ps1.data.clean, aes(x=dmage))
split.age <- split.age +
geom_density() +
theme_bw() +
xlab("Maternal Age (years)") +
ylab("Density in Sub-sample") +
facet_grid(tobacco~.)
arrange_ggplot2(bw.age, split.age, ncol=1)
dev.off()
# birth weight - age
pdf(file="img/bw-age.pdf", width=5, height=7)
bw.age <- ggplot(ps1.data.clean, aes(dmage, dbrwt))
bw.age <- bw.age +
stat_smooth() +
theme_bw() +
xlab("Maternal Age (years)") +
ylab("Birth Weight (grams)") +
facet_grid(full.record~.)
split.age <- ggplot(ps1.data.clean, aes(x=dmage))
split.age <- split.age +
geom_density() +
theme_bw() +
xlab("Maternal Age (years)") +
ylab("Density in Sub-sample") +
facet_grid(tobacco~.)
arrange_ggplot2(bw.age, split.age, ncol=1)
dev.off()
ggplot(ps1.data.clean, aes(dmeduc, dbrwt))+geom_points()
ggplot(ps1.data.clean, aes(dmeduc, dbrwt))+geom_point()
ggplot(ps1.data.clean, aes(dmeduc, dbrwt))+geom_point() + stat_smooth()
ggplot(ps1.data.clean, aes(dmar, dbrwt))+geom_point() + stat_smooth()
ggplot(ps1.data.clean, aes(dbrwt))+geom_hist() + facet_grid(dmar~.)
ggplot(ps1.data.clean, aes(dbrwt))+geom_histogram() + facet_grid(dmar~.)
ggplot(ps1.data.clean, aes(dbrwt))+geom_boxplot(aes(factor=dmar)
)
ggplot(ps1.data.clean, aes(y=dbrwt))+geom_boxplot(aes(factor=dmar))
ggplot(ps1.data.clean, aes(dbrwt, factor(dmar)))+geom_boxplot()
ggplot(ps1.data.clean, aes(factor(dmar),dbrwt))+geom_boxplot()
ps1.data.clean$dmar <- as.factor(ps1.data.clean$dmar)
ps1.data.clean$dmar <- revalue(ps1.data.clean$dmar, c("1" = "Married", "2" = "Unmarried"))
## CrossTabs
ps1.xtab.data <- ps1.data.clean
# Add labels from ps1.data
for(i in 1:length(names(ps1.data))){
label(ps1.xtab.data[[i]]) <- attr(ps1.data, "var.labels")[i]
}
latex(summary( tobacco  ~
mrace3 +
csex +
dmar +
dplural +
alcohol +
phyper +
chyper +
cardiac +
diabetes +
pre4000 +
dmage +
clingest,
data=ps1.xtab.data,
method="reverse",
overall=TRUE, long=TRUE
),
title = "crosstab-tobacco",
label = "tab:xtabTobacco",
caption = "Contingency table for a range of factors by tobacco use status",
exclude1=F
)
# birth weight - marriage
pdf(file="img/bw-mar.pdf", width=5, height=7)
bw.mar <- ggplot(ps1.data.clean, aes(factor(dmar),dbrwt))
bw.mar <- bw.mar +
geom_boxplot() +
theme_bw() +
xlab("Marital Status") +
ylab("Birth Weight")
print(bw.mar)
dev.off()
# birth weight - marriage
pdf(file="img/bw-mar.pdf", width=5, height=4)
bw.mar <- ggplot(ps1.data.clean, aes(factor(dmar),dbrwt))
bw.mar <- bw.mar +
geom_boxplot() +
theme_bw() +
xlab("Marital Status") +
ylab("Birth Weight")
print(bw.mar)
dev.off()
# birth weight - marriage
pdf(file="img/bw-mar.pdf", width=5, height=4)
bw.mar <- ggplot(ps1.data.clean, aes(factor(dmar),dbrwt))
bw.mar <- bw.mar +
geom_boxplot() +
theme_bw() +
xlab("Marital Status") +
ylab("Birth Weight (grams)")
print(bw.mar)
dev.off()
ggplot(ps1.data.clean, aes(monpre, dbrwt)) + stat_smooth()
latex(summary( tobacco  ~
mrace3 +
csex +
dmar +
monpre +
dplural +
alcohol +
phyper +
chyper +
cardiac +
diabetes +
pre4000 +
dmage +
clingest,
data=ps1.xtab.data,
method="reverse",
overall=TRUE, long=TRUE
),
title = "crosstab-tobacco",
label = "tab:xtabTobacco",
caption = "Contingency table for a range of factors by tobacco use status",
exclude1=F
)
ggplot(ps1.data.clean, aes(birmon, dbrwt)) + stat_smooth()
ggplot(ps1.data.clean, aes(wgain, dbrwt)) + stat_smooth()
latex(summary( tobacco  ~
mrace3 +
csex +
dmar +
dplural +
alcohol +
phyper +
chyper +
cardiac +
diabetes +
pre4000 +
monpre +
dmage +
clingest +
wgain,
data=ps1.xtab.data,
method="reverse",
overall=TRUE, long=TRUE
),
title = "crosstab-tobacco",
label = "tab:xtabTobacco",
caption = "Contingency table for a range of factors by tobacco use status",
exclude1=F
)
# birth weight - maternal weight gain
pdf(file="img/bw-gain.pdf", width=5, height=7)
bw.gain <- ggplot(ps1.data.clean, aes(wgain, dbrwt))
bw.gain <- bw.age +
stat_smooth() +
theme_bw() +
xlab("Maternal Weight Gain (lbs)") +
ylab("Birth Weight (grams)") +
facet_grid(full.record~.)
split.gain <- ggplot(ps1.data.clean, aes(x=wgain))
split.gain <- split.age +
geom_density() +
theme_bw() +
xlab("Maternal Weight Gain (lbs)") +
ylab("Density in Sub-sample") +
facet_grid(tobacco~.)
arrange_ggplot2(bw.gain, split.gain, ncol=1)
dev.off()
# birth weight - maternal weight gain
pdf(file="img/bw-gain.pdf", width=5, height=7)
bw.gain <- ggplot(ps1.data.clean, aes(wgain, dbrwt))
bw.gain <- bw.gain +
stat_smooth() +
theme_bw() +
xlab("Maternal Weight Gain (lbs)") +
ylab("Birth Weight (grams)") +
facet_grid(full.record~.)
split.gain <- ggplot(ps1.data.clean, aes(x=wgain))
split.gain <- split.gain +
geom_density() +
theme_bw() +
xlab("Maternal Weight Gain (lbs)") +
ylab("Density in Sub-sample") +
facet_grid(tobacco~.)
arrange_ggplot2(bw.gain, split.gain, ncol=1)
dev.off()
